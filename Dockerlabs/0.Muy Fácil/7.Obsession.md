# Write-up:
- **Nombre de la m√°quina:** Obsession 
- **Plataforma:** Dockerlabs 
- **IP:** 172.18.0.2 
- **SO:** Linux 
- **Dificultad:** Muy F√°cil 

## 1. RECONOCMIENTO 

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m√°quina v√≠ctima. 

#### 1.1 Verificaci√≥n de Conectividad. 
Se lanza un `ping` para confirmar que la m√°quina est√° activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.

```
 ping 172.17.0.2
```
Nos devuelve conectividad y un TTL=64 por lo que estamos ante una m√°quina Linux. 

<p align="center">
    <img src="Imagenes/178.png" width="1000">
</p>



#### 1.2 Escaneo de Puertos



Lanzamos un NMAP para ver los puertos abiertos, los servicio y versiones que  corre por ellos.
```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -vvv -n -Pn 172.18.0.2  -oN port_scan.txt
```

**Puertos Descubiertos**:


| **Puerto** | Servicio | Versi√≥n          | Notas                                  |
| ---------- | -------- | ---------------- | -------------------------------------- |
| 21         | FTP      | vsftpd 3.0.5<br> | Protocolo de transferencia de archivos |
| 22         | SSH      | OpenSSH 9.6p1    | Protocolo de conexi√≥n remota           |
| 80         | HTTP     | httpd 2.4.58     | Protocolo de servicio web              |


<p align="center">
    <img src="Imagenes/179.png" width="1000">
</p>

Para deducir por donde continuaremos en la enumeraci√≥n; sabemos que para el servicio `ssh` ser√° m√°s efectivo cuando tengamos alguna credencial. Ya sea usuario y contrase√±a o una clave rsa.
Debemos comprobar si el servicio `FTP` es vulnerable a un inicio de sesi√≥n an√≥nimo y si esto no es posible buscaremos elementos para continuar con la explotaci√≥n en el servicio `http` . 

## 2. Enumeraci√≥n

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci√≥n √∫til.

### 21(FTP)

No existen herramientas propias para enumerar `FTP` por lo que utilizaremos `Nmap` 
```
sudo nmap -p21 --script ftp-anon 172.17.0.2
```

Comprobamos con un script de `Nmap` si tendr√≠amos acceso al servicio con un usuario an√≥nimo. 

<p align="center">
    <img src="Imagenes/180.png" width="1000">
</p>

El servidor `FTP` nos permite el acceso an√≥nimo y 2 archivos en su contenido

Nos conectamos de forma an√≥nima al servidor con las credenciales `anonymous:anonymous`
```
ftp 172.17.0.2
```

<p align="center">
    <img src="Imagenes/181.png" width="1000">
</p>

Descargamos ambos archivos con el comando `get` y lo revisamos con el comando `cat` en nuestro directorio de trabajo. 

<p align="center">
    <img src="Imagenes/182.png" width="1000">
</p>

```
cat chat-gonza.txt
```

<p align="center">
    <img src="Imagenes/183.png" width="1000">
</p>

Encontramos el contenido de un chat entre dos posibles usuarios `Gonza` y `Russoki` con un contenido bastante turbio. 

```
cat pendientes.txt
``` 

<p align="center">
    <img src="Imagenes/184.png" width="1000">
</p>

En su contenido habla sobre que tiene pendiente cambiar permisos poco seguros. 

- **Hallazgos**
	Posibles usuario: `Gonza` y `Russoki`

### Puerto 80 (HTTP) :

Se accede a la web y encontramos una web relacionada con el entrenamiento personal.  

<p align="center">
    <img src="Imagenes/185.png" width="1000">
</p>


Accedemos a su c√≥digo `Click derecho> inspeccionar` 

Donde podemos ver un comentario que nos dice ` Utilizando el mismo usuario para todos mis servicios, podr√© recordarlo f√°cilmente` 

<p align="center">
    <img src="Imagenes/186.png" width="1000">
</p>

Actuaremos en dos frentes de la ENUMERACI√ìN paralelamente:

#### Enumeraci√≥n manual:
Buscamos directorios comunes de forma manual:

	/robots.txt -->X
	/sitemap.xml--> X
	/login--> X
	/admin--> X
	/panel-->X
	/user-->X
	 /backup, --> V
	 /uploads, --> X
	 /test--> X

Encontramos un directorio `backup` 

<p align="center">
    <img src="Imagenes/187.png" width="1000">
</p>
`backup.txt`: 

<p align="center">
    <img src="Imagenes/189.png" width="1000">
</p>

- Hallazgos:
	En `backup.txt` : confirmamos el usuario `russoski` y adem√°s nos dice que es el usuario para todos los servicios. 

#### Enumeraci√≥n autom√°tica:
Lazamos la herramienta de enumeraci√≥n `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html de forma autom√°tica
```
sudo gobuster dir -u http://172.18.0.2/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x txt,php,html  -k
```

Nos devuelve varias rutas, habiendo descubierto de forma manual ya `/backup` vemos llamativa `/important` 

<p align="center">
    <img src="Imagenes/190.png" width="1000">
</p>

Estudiamos esta direcci√≥n : 172.18.0.2/important 

<p align="center">
    <img src="Imagenes/191.png" width="1000">
</p>
Accedemos a `important.md`

<p align="center">
    <img src="Imagenes/192.png" width="1000">
</p>
Manifiesto Hacker. 

### Puerto 22(SSH)

Si recordamos para acceder al servicio que corre en el puerto :22, el servicio `ssh` necesitamos alg√∫n tipo de credencial. Debemos probar si con este usuario que hemos encontrado `russoski` podemos acceder. 

Para ello utilizaremos la fuerza bruta con la herramienta `Hydra` que probar√° un diccionario con miles de opciones de contrase√±a para el usuario que le aportamos. 
```
hydra -t 4 -l russsoski -P /usr/share/wordlists/rockyou.txt ssh://172.18.0.2
```

Averigua que para el usuario mario la password es `iloveme`
russoski:iloveme

<p align="center">
    <img src="Imagenes/193.png" width="1000">
</p>


## 3. Explotaci√≥n

### 3.1 Acceso inicial:

Con las credenciales descubiertas `mario:chocolate`  nos conectamos al servicio ssh:
```
ssh russoski@172.18.0.2
```

<p align="center">
    <img src="Imagenes/194.png" width="1000">
</p>

### 3.2 Enumeraci√≥n Interna:
Una vez hemos entrado al sistema debemos hacer algunas comprobaciones.
	¬øQu√© usuario somos?
	¬øA qu√© grupo pertenecemos?
	¬øQu√© usuarios hay en el sistema?
	
#### 3.2.1 Comprobaciones

¬øQui√©nes somos? `whoami`

<p align="center">
    <img src="Imagenes/195.png" width="1000">
</p>
  
¬øA qu√© grupo pertenecemos? `id`

<p align="center">
    <img src="Imagenes/196.png" width="1000">
</p>

¬øQu√© usuarios hay en el sistema?
`cd /home`
`ls -la`

¬øQu√© usuario tienen una shell asignada?

`cat /etc/passwd | grep sh`

<p align="center">
    <img src="Imagenes/197.png" width="1000">
</p>

Revisamos los directorios de los usuarios:
Ubuntu: denegado 

<p align="center">
    <img src="Imagenes/198.png" width="1000">
</p>

Russsoski: 

<p align="center">
    <img src="Imagenes/199.png" width="1000">
</p>

Podemos ver directorios como `Documentos` y `Proyectos`

- `Documentos` : listamos una foto de Nikola Tesla y la descargamos con el comando `get Nikola Tesla.jpg ` bastante profunda
  
<p align="center">
    <img src="Imagenes/199.1.png" width="1000">
</p>


No vemos nada m√°s relevante 
Una buena pr√°ctica ser√≠a revisar los comandos utilizados por los usuarios en el `history`


#### 3.2.2 B√∫squeda del Vector de Escalada de privilegios:

Tras las comprobaciones iniciales, el siguinete paso es buscar una forma de elevar nuestros privilegios al usuario root. 

Una de las primeras verificaciones es comprobar qu√© permisos tiene nuestro usuario `russsoski` para ejecutar comando con `sudo`:
```
sudo -l
```

En este caso podemos ejecutar como root  el editor de texto `vim`
<p align="center">
    <img src="Imagenes/199.2.png" width="1000">
</p>


### 3.3 Explotaci√≥n y Escalada a Root


Debido a que `vim` es un editor de texto que permite ejecutar comandos de sistema desde si interfaz. Al poder ejecutar `vim` como  `root ` podemos usar esta funcionalidad para lanzar una shell que tendr√° privilegios de `root`.

1. Ejecutar `vim` como sudo:
	`sudo vim`
2. Obtener una Shell de Root:
   Un vez dentro de la interfaz de `vim`:

	- primero ejecuta el s√≠mbolo `:` Esto hace que aparezca una l√≠nea de comando abajo (ver√°s algo como `:` esperando que escribas un comando).

<p align="center">
    <img src="Imagenes/112.png" width="1000">
</p>

  -  A continuaci√≥n  ejecuta el comando  `shell`  escribi√©ndolo y pulsando enter.
	
<p align="center">
	 <img src="Imagenes/113.png" width="1000">
</p>


3. Verificamos la escalada 
	   `whoami`
	   
	Somos root üöÄ
<p align="center">
    <img src="Imagenes/Captura de pantalla 2025-08-07 110936.png" width="1000">
</p>

