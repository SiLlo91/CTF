# Write-up:
- **Nombre de la m치quina:** Obsession 
- **Plataforma:** Dockerlabs 
- **IP:** 172.18.0.2 
- **SO:** Linux 
- **Dificultad:** Muy F치cil 

## 1. RECONOCMIENTO 

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m치quina v칤ctima. 

#### 1.1 Verificaci칩n de Conectividad. 
Lanzamos ping para confirmar que la m치quina est치 activa y obtener el TTL , que nos aportar치 una pista sobre el sistema operativo

`ping 172.18.0.2` 

Nos devuelve conectividad y un ttl=64 por lo que deducimos que se trata de un m치quina Linux.

![](Imagenes/178.png)



#### 1.2 Escaneo de Puertos



Lanzamos un NMAP para ver los puertos abiertos, los servicio y versiones que  corre por ellos.

`sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -vvv -n -Pn 172.18.0.2  -oN port_scan.txt`

**Puertos Descubiertos**:


| **Puerto** | Servicio | Versi칩n          | Notas                                  |
| ---------- | -------- | ---------------- | -------------------------------------- |
| 21         | FTP      | vsftpd 3.0.5<br> | Protocolo de transferencia de archivos |
| 22         | SSH      | OpenSSH 9.6p1    | Protocolo de conexi칩n remota           |
| 80         | HTTP     | httpd 2.4.58     | Protocolo de servicio web              |

/ 

![](Imagenes/179.png)

Sabemos que para el servicio `ssh` ser치 m치s efectivo cuando tengamos alguna credencial. Ya sea usuario y contrase침a o una clave rsa.
Debemos comprobar si el servicio `FTP` es vulnerable a un inicio de sesi칩n an칩nimo y si esto no es posible buscaremos elementos para continuar con la explotaci칩n en el servicio `http` . 

## 2. Enumeraci칩n

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci칩n 칰til.
### 21(FTP)

No existen herramientas propias para enumerar `FTP` por lo que utilizaremos `Nmap` 

`sudo nmap -p21 --script ftp-anon 172.17.0.2`

Comprobamos con un script de `Nmap` si tendr칤amos acceso al servicio con un usuario an칩nimo. 

![](Imagenes/180.png)
El servidor `FTP` nos permite el acceso an칩nimo y 2 archivos en su contenido

Nos conectamos de forma an칩nima al servidor con las credenciales `anonymous:anonymous`

`ftp 172.17.0.2`

![](Imagenes/181.png)

Descargamos ambos archivos con el comando `get` y lo revisamos con el comando `cat` en nuestro directorio de trabajo. 

![](Imagenes/182.png)

`cat chat-gonza.txt`

![](Imagenes/183.png)
Encontramos el contenido de un chat entre dos posibles usuarios `Gonza` y `Russoki` con un contenido bastante turbio. 


`cat pendientes.txt` :

![](Imagenes/184.png)
En su contenido habla sobre que tiene pendiente cambiar permisos poco seguros. 

- **Hallazgos **
	Posibles usuario: `Gonza` y `Russoki`

### Puerto 80 (HTTP) :

Se accede a la web y encontramos una web relacionada con el entrenamiento personal.  

![](Imagenes/185.png)


Accedemos a su c칩digo `Click derecho> inspeccionar` 

Donde podemos ver un comentario que nos dice ` Utilizando el mismo usuario para todos mis servicios, podr칠 recordarlo f치cilmente` 

![](Imagenes/186.png)

Actuaremos en dos frentes de la ENUMERACI칍N paralelamente:

#### Enumeraci칩n manual:
Buscamos directorios comunes de forma manual:

	/robots.txt -->X
	/sitemap.xml--> X
	/login--> X
	/admin--> X
	/panel-->X
	/user-->X
	 /backup, --> V
	 /uploads, --> X
	 /test--> X

Encontramos un directorio `backup` 

![](Imagenes/187.png)
`backup.txt`: 

![](Imagenes/189.png)

- Hallazgos:
	- en `backup.txt` : confirmamos el usuario `russoski` y adem치s nos dice que es el usuario para todos los servicios. 

#### Enumeraci칩n autom치tica:
Lazamos la herramienta de enumeraci칩n `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html de forma autom치tica

`sudo gobuster dir -u http://172.18.0.2/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x txt,php,html  -k`

Nos devuelve varias rutas, habiendo descubierto de forma manual ya `/backup` vemos llamativa `/important` 

![](Imagenes/190.png)
Estudiamos esta direcci칩n : 172.18.0.2/important 

![](Imagenes/191.png)

Accedemos a `important.md`

![](Imagenes/192.png)
Manifiesto Hacker. 

### Puerto 22(SSH)

Si recordamos para acceder al servicio que corre en el puerto :22, el servicio `ssh` necesitamos alg칰n tipo de credencial. Debemos probar si con este usuario que hemos encontrado `russoski` podemos acceder. 

Para ello utilizaremos la fuerza bruta con la herramienta `Hydra` que probar치 un diccionario con miles de opciones de contrase침a para el usuario que le aportamos. 

`hydra -t 4 -l russsoski -P /usr/share/wordlists/rockyou.txt ssh://172.18.0.2`

Averigua que para el usuario mario la password es `iloveme`
russoski:iloveme

![](Imagenes/193.png)


## 3. Explotaci칩n

### 3.1 Acceso inicial:

Con las credenciales descubiertas `mario:chocolate`  nos conectamos al servicio ssh:

`ssh russoski@172.18.0.2`

 ![](Imagenes/194.png)

### 3.2 Enumeraci칩n Interna:
Una vez hemos entrado al sistema debemos hacer algunas comprobaciones.
	쯈u칠 usuario somos?
	쮸 qu칠 grupo pertenecemos?
	쯈u칠 usuarios hay en el sistema?
	
#### 3.2.1 Comprobaciones

쯈ui칠nes somos?
`whoami`

 ![](Imagenes/195.png)
  
쮸 qu칠 grupo pertenecemos?
`id`
![](Imagenes/196.png)
쯈u칠 usuarios hay en el sistema?
`cd /home`
`ls -la`

쯈u칠 usuario tienen una shell asignada?

`cat /etc/passwd | grep sh`

![](Imagenes/197.png)

Revisamos los directorios de los usuarios:
Ubuntu: denegado 

![](Imagenes/198.png)

Russsoski: 

![](Imagenes/199.png)
Podemos ver directorios como `Documentos` y `Proyectos`

- `Documentos` : listamos una foto de Nikola Tesla y la descargamos con el comando `get Nikola Tesla.jpg ` bastante profunda
  
   ![](Imagenes/199.1.png)


No vemos nada m치s relevante 
Una buena pr치ctica ser칤a revisar los comandos utilizados por los usuarios en el `history`


#### 3.2.2 B칰squeda del Vector de Escalada de privilegios:

Tras las comprobaciones iniciales, el siguinete paso es buscar una forma de elevar nuestros privilegios al usuario root. 

Una de las primeras verificaciones es comprobar qu칠 permisos tiene nuestro usuario `russsoski` para ejecutar comando con `sudo`:
	`sudo -l`

En este caso podemos ejecutar como root  el editor de texto `vim`
 ![](Imagenes/199.2.png)


### 3.3 Explotaci칩n y Escalada a Root


Debido a que `vim` es un editor de texto que permite ejecutar comandos de sistema desde si interfaz. Al poder ejecutar `vim` como  `root ` podemos usar esta funcionalidad para lanzar una shell que tendr치 privilegios de `root`.

1. Ejecutar `vim` como sudo:
	`sudo vim`
2. Obtener una Shell de Root:
   Un vez dentro de la interfaz de `vim`:
	- primero ejecuta el s칤mbolo `:` Esto hace que aparezca una l칤nea de comando abajo (ver치s algo como `:` esperando que escribas un comando).
	   ![](Imagenes/112.png)
	- A continuaci칩n  ejecuta el comando  `shell`  escribi칠ndolo y pulsando enter
	  ![](Imagenes/113.png)
3. Verificamos la escalada 
	   `whoami`
	   
	Somos root 游
	![[Imagenes/Captura de pantalla 2025-08-07 110936.png]]
