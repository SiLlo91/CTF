# Write-up: Vacaciones

- **Nombre de la m치quina:** `Vacaciones` 
- **Plataforma:** `Dockerlabs` 
- **IP:** `172.17.0.2` 
- **SO:** `Linux` 
- **Dificultad:** `Muy F치cil`

---

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m치quina v칤ctima.

#### 1.1. Verificaci칩n de Conectividad

Se lanza un `ping` para confirmar que la m치quina est치 activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.
	`ping 172.17.0.2`
Nos devuelve conectividad y un TTL=64 por lo que estamos ante una m치quina Linux.
![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/117.png)

#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.

```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 172.17.0.2 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versi칩n       | Notas                    |
| ------ | -------- | ------------- | ------------------------ |
| 22     | ssh      | OpenSSH 7.6   | Necesitamos credenciales |
| 80     | http     | Apache 2.4.29 | Iniciaremos por aqu칤     |
-
![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/118.png)
Normalmente el acceso por el puerto 22 al servicio ssh requiere de credenciales. Ya sea usuario y contrase침a o clave rsa. En este caso carecemos de informaci칩n al respecto as칤 que lo m치s productivo es explorar el puerto :80

---

## 2. ENUMERACI칍N

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci칩n 칰til.

### Puerto 80 ( HTTP)

#### Enumeraci칩n Manual:

- **Navegaci칩n web:** Se visita el sitio en `http://172.17.0.2.
    Tenemos una p치gina en blanco
    
     ![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/119.png)
- **An치lisis del c칩digo fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos.
    Encontramos los nombres de dos posibles usuarios:
	    `Juan` y `Camilo`
	![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/120.png)
- **Archivos comunes:** Se buscan manualmente archivos y directorios comunes:
	- `/robots.txt`-->X
	- `/sitemap.xml`--> X
	- `/login`--> X
	- `/admin`--> X
	- `/panel`--> X
	- `/user`--> X
	- `/panel`--> X
	- `backup`--> X
	- `uploads`--> X
	- `test, etc.`--> X
    
    No encontramos nada
#### Enumeraci칩n Autom치tica:

Lanzamos la herramienta de enumeraci칩n `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 

```
gobuster dir -u http://172.17.0.2/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```
![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/121.png)
**Hallazgos:**

- Nos devuelve algunas rutas pero nada llamativo

### 22(SSH)

Si recordamos para acceder al servicio que corre en el puerto :22, el servicio `ssh`, necesitamos alg칰n tipo de credencial. Debemos probar si con los usuarios que hemos encontrado `Juan` y `Camilo` podemos acceder. 

Para ello utilizaremos la fuerza bruta con la herramienta `Hydra` que probar치 un diccionario con miles de opciones de contrase침a para el usuario que le aportamos. 

`hydra -t 4 -l camilo -P /usr/share/wordlists/rockyou.txt ssh://172.17.0.2`

Averigua que para el usuario camilo la password es `password1`

![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/122.png)

**Credenciales obtenidas:**
- **Usuario:** `camilo`
- **Contrase침a:** `password1`
---

## 3. EXPLOTACI칍N

### 3.1 Acceso inicial:

Con las credenciales descubiertas `camilo:password1`  nos conectamos al servicio ssh:

	ssh camilo@172.17.0.2
	
![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/123.png)
### Estabilizaci칩n de la TTY:
Buscamos una shell que pueda interactuar de forma correcta en la terminal. En este caso generamos una shell pseudo-interactiva, muy simple,  que 칰til para el alcance de este CTF. 

`script /dev/null -c bash`

![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/124.png)


---

## 4. ESCALADA DE PRIVILEGIOS

Una vez dentro, el objetivo es elevar los privilegios del usuario actual al de `root`.

### 4.1. Enumeraci칩n Interna

Se realizan comprobaciones b치sicas y se buscan posibles vectores de escalada.

#### Comprobaciones del sistema:

쯈u칠 usuario somos?
`whoami`

쮸 qu칠 grupo pertenezco?
`id`
 ![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/125.png)
 
 
쯈u칠 usuario hay en el sistema?
`cd home` y `ls` 

![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/126.png)

쯈u칠 usuario tienen una shell asignada?

`cat /etc/passwd | grep sh`

![](Imagenes/127.png)

Revisamos los directorios de los usuarios:
Camilo:

 ![](Imagenes/128.png)
 
Juan:

![](Imagenes/129.png)

Pedro:

![](Imagenes/130.png)

Una buena pr치ctica ser칤a revisar los comandos utilizados por los usuarios en el `history`
#### B칰squeda del Vector de Escalada:

- **Permisos Sudo:** 쯈u칠 comandos podemos ejecutar como otro usuario (o `root`)?
    ```
    sudo -l
    ```
    Con el usuario `camilo` para el que tenemos credenciales no existe ning칰n comando que pueda ejecutar como `root`
- **Binarios SUID/SGID:** 쮼xisten binarios con permisos especiales que puedan ser abusados?
    
    ```
    find / -perm -4000 2>/dev/null
    ```
    No encontramos binarios de los que podamos abusar.
    
    ![](Imagenes/131.png)

- **Buscamos el correo del que nos hab칤an hablado en el c칩digo fuente del servicio web **
	`find / -name "mail" 2>/dev/null`

	Damos con la ruta donde se haya el correo. 
	
	![](Imagenes/132.png)
	Nos movemos hasta ese punto de la ruta y abrimos el archivo que se encuentra en el directorio de `camilo`, `correo.txt` 
	![](Imagenes/133.png)
	Obtenido las credenciales de otro compa침ero. 
	`2k84dicb`
- Probamos la contrase침a con el usuario `juan` y funciona. 
	![](Imagenes/134.png)
	
	Como vemos no tenemos promt asi que vamos  volver a utilizar el comando que hemos usado anteriormente para pseudo estabilizar la TTY . 
		`script /dev/null -c bash`
		
- Siendo el usuario Juan comprobamos de nuevo los **Permisos Sudo:** 쯈u칠 comandos podemos ejecutar como otro usuario (o `root`)?
    ```
    sudo -l
	```
	![](Imagenes/135.png)
	Vemos que podemos ejecutar como `sudo` `usr/bin/ruby`


### 4.2. Explotaci칩n y Escalada a Root

Se ejecuta la t칠cnica para obtener una shell como `root`.

**Referencia (GTFOBins.):** https://gtfobins.github.io/gtfobins/ruby/#sudo 
![](Imagenes/136.png)
**Comando de explotaci칩n:**

```
sudo ruby -e 'exec "/bin/sh"'
```

**Verificaci칩n:**

```
whoami
```

![](Imagenes/137.png)

SOMOS ROOT 游


---

