# Write-up: BreakMySSH

- **Nombre de la m√°quina:** `Borazuwarahctf` 
- **Plataforma:** `Dockerlabs` 
- **IP:** `172.17.0.2` 
- **SO:** `Linux` 
- **Dificultad:** `Muy F√°cil`


-----------------------

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m√°quina v√≠ctima.

#### 1.1. Verificaci√≥n de Conectividad

Se lanza un `ping` para confirmar que la m√°quina est√° activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.

```
 ping 172.17.0.2
```
Nos devuelve conectividad y un TTL=64 por lo que estamos ante una m√°quina Linux. 
<p align="center">
    <img src="Imagenes/148.png" width="1000">
</p>


#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.

```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 172.17.0.2 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versi√≥n       | Notas |
| ------ | -------- | ------------- | ----- |
| 22     | SSH      | OpenSSH 7.7   | Credenciales necesarias      |
| 80     | HTTP     | Apache 2.4.59 |  Punto de entrada     |

<p align="center">
    <img src="Imagenes/149.png" width="1000">
</p>

Normalmente El servicio **SSH(Secure Shell)** , que com√∫nmente opera en el **puerto 22**, requiere credenciales para permitir el acceso. Los m√©todos de autenticaci√≥n habituales son:

- **Usuario y contrase√±a**.
- **Pares de claves criptogr√°ficas** (como RSA o ECDSA).

Normalmente el acceso por el puerto 22 al servicio ssh requiere de credenciales. Ya sea usuario y contrase√±a o clave rsa. En este caso carecemos de informaci√≥n al respecto as√≠ que lo m√°s productivo es explorar el puerto :80
## 2. ENUMERACI√ìN

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci√≥n √∫til.

### Puerto 80 ( HTTP)

#### Enumeraci√≥n Manual:

- **Navegaci√≥n web:** Se visita el sitio en http://172.17.0.2.
- 
    Tenemos una p√°gina con un huevo kinder bastante bacano
    
<p align="center">
    <img src="Imagenes/150.png" width="1000">
</p>

- **An√°lisis del c√≥digo fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos.
    No encontramos nada relevante
<p align="center">
    <img src="Imagenes/151.png" width="1000">
</p>

- **Archivos comunes:** Se buscan manualmente archivos y directorios comunes:
	- `/robots.txt`-->X
	- `/sitemap.xml`--> X
	- `/login`--> X
	- `/admin`--> X
	- `/panel`--> X
	- `/user`--> X
	- `/panel`--> X
	- `backup`--> X
	- `uploads`--> X
	- `test, etc.`--> X
    
    No encontramos nada
#### Enumeraci√≥n Autom√°tica:

- Lanzamos la herramienta `whatweb` para Identificar las tecnolog√≠as del servidor en nuestro caso Apache:
```
whatweb 172.17.0.2
```

<p align="center">
    <img src="Imagenes/152.png" width="1000">
</p>


- Lanzamos la herramienta de enumeraci√≥n `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 

```
gobuster dir -u http://172.17.0.2/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```

<p align="center">
    <img src="Imagenes/166.png" width="1000">
</p>

**Hallazgos:**

- Nos devuelve algunas rutas pero nada llamativo


Tras investigar posibles directivos y  buscar  vulnerabilidades a la versi√≥n de Apache sin √©xito en metasploit. Nos centramos en lo que tenemos, la imagen del huevo bacano. Descargamos la imagen en el directorio de trabajo. 

- Lanzamos la herramienta de estenograf√≠a `exiftools`
```
exiftool imagen.jpeg
```

  
<p align="center">
    <img src="Imagenes/154.png" width="1000">
</p>

Como alternativa a `exiftools` podremos usar `strings`
```
strings Unitled.jpeg
```

<p align="center">
    <img src="Imagenes/155.png" width="1000">
</p>



**Hallazgos:**

- Nos devuelve en su output un user: `borazuwarah`




### 22(SSH)

Si recordamos para acceder al servicio que corre en el puerto :22, el servicio `ssh`, necesitamos alg√∫n tipo de credencial. Debemos probar si con este usuario que hemos encontrado `borazuwarah` podemos acceder.

Para ello utilizaremos la fuerza bruta con la herramienta `Hydra` que probar√° un diccionario con miles de opciones de contrase√±as para el usuario que le aportamos. 
```
hydra -t 4 -l borazuwarah -P /usr/share/wordlists/rockyou.txt ssh://172.18.0.2
```
Averigua que para el usuario borazuwarah la password es `123456`
borazuwarah:123456

Averigua las credenciales de usuario para el servicio ssh.
<p align="center">
    <img src="Imagenes/156.png" width="1000">
</p>
 

**Credenciales obtenidas:**
- **Usuario:** `borazuwarah`
- **Contrase√±a:** `123456`


## 3. EXPLOTACI√ìN

### 3.1 Acceso inicial :

Con las credenciales descubiertas `borazuwarah:123456`  nos conectamos al servicio ssh:
```
	ssh borazuwarah@172.17.0.2
```

<p align="center">
    <img src="Imagenes/157.png" width="1000">
</p>



Como podemos ver, las credenciales ya nos conectan al servicio como el usuario borazuwarah.

## 4. ESCALADA DE PRIVILEGIOS

Una vez dentro, el objetivo es elevar los privilegios del usuario actual al de `root`.

### 4.1. Enumeraci√≥n Interna

Se realizan comprobaciones b√°sicas y se buscan posibles vectores de escalada.

#### Comprobaciones del sistema:

¬øQu√© usuario somos?
`whoami`

<p align="center">
    <img src="Imagenes/158.png" width="1000">
</p>
¬øA qu√© grupo pertenezco? `id`

<p align="center">
    <img src="Imagenes/159.png" width="1000">
</p>
 
¬øQu√© usuario hay en el sistema?
`cd home` y `ls`
<p align="center">
    <img src="Imagenes/160.png" width="1000">
</p>
 
 
 ¬øQu√© usuario tienen una shell asignada?

`cat /etc/passwd | grep sh`

<p align="center">
    <img src="Imagenes/161.png" width="1000">
</p>


Revisamos los directorios de los usuarios:
borazuwarah: 

<p align="center">
    <img src="Imagenes/162.png" width="1000">
</p>




Una buena pr√°ctica ser√≠a revisar los comandos utilizados por los usuarios en el `history`


#### B√∫squeda del Vector de Escalada:

- **Permisos Sudo:** ¬øQu√© comandos podemos ejecutar como otro usuario (o `root`)?
	```
    sudo -l
	```
    Con el usuario `borazuwarah`  puede ejecutar una shell `/bin/bash` como usuario `root` sin necesidad de contrase√±a.
<p align="center">
    <img src="Imagenes/153.png" width="1000">
</p>
    
    
	Este ser√° el hilo desde el que tirar para escalar privilegios. 
	La mala configuraci√≥n de `sudoers` nos deja un vector de escalada. 
	
	**Cuando lanzamos el comando sudo -l ** podemos ver que tenemos permisos como el usuario borazuwarah para ejecutar como `root` . Pero quer√≠a investigar otras alternativas.
	
<p align="center">
    <img src="Imagenes/163.png" width="1000">
</p>
	

- **Binarios SUID/SGID:** ¬øExisten binarios con permisos especiales que puedan ser abusados?
    
	 ```
    find / -perm -4000 2>/dev/null
	 ```
    No encontramos binarios de los que podamos abusar.
    
<p align="center">
    <img src="Imagenes/164.png" width="1000">
</p>
    


****
### 4.2. Explotaci√≥n y Escalada a Root

Se ejecuta la t√©cnica para obtener una shell como `root`.

Para ello ejecutamos `/bin/bash` a trav√©s de `sudo` 
```
sudo /bin/bash
```

<p align="center">
    <img src="Imagenes/165.png" width="1000">
</p>


SOMOS ROOT üöÄ


