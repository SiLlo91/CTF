# Write-up: BreakMySSH

- **Nombre de la m치quina:** `Borazuwarahctf` 
- **Plataforma:** `Dockerlabs` 
- **IP:** `172.17.0.2` 
- **SO:** `Linux` 
- **Dificultad:** `Muy F치cil`


-----------------------

## 1. RECONOCIMIENTO

El objetivo de esta fase es identificar los puntos de entrada y servicios expuestos en la m치quina v칤ctima.

#### 1.1. Verificaci칩n de Conectividad

Se lanza un `ping` para confirmar que la m치quina est치 activa y obtener el TTL lo que puede darnos una primera pista sobre el sistema operativo.

```
 ping 172.17.0.2
```
Nos devuelve conectividad y un TTL=64 por lo que estamos ante una m치quina Linux. 

 ![](Imagenes/148.png)

#### 1.2. Escaneo de Puertos

Se realiza un escaneo con **Nmap** para descubrir puertos abiertos, los servicios que corren en ellos y sus versiones.

```
sudo nmap -p- -sV -sC -sS --min-rate 5000 --open -n -Pn 172.17.0.2 -oN port_scan.txt
```

**Puertos Descubiertos:**

| Puerto | Servicio | Versi칩n       | Notas |
| ------ | -------- | ------------- | ----- |
| 22     | SSH      | OpenSSH 7.7   |       |
| 80     | HTTP     | Apache 2.4.59 |       |

/
![](Imagenes/149.png)

Normalmente El servicio **SSH (Secure Shell)**, que com칰nmente opera en el **puerto 22**, requiere credenciales para permitir el acceso. Los m칠todos de autenticaci칩n habituales son:

- **Usuario y contrase침a**.
- **Pares de claves criptogr치ficas** (como RSA o ECDSA).

Normalmente el acceso por el puerto 22 al servicio ssh requiere de credenciales. Ya sea usuario y contrase침a o clave rsa. En este caso carecemos de informaci칩n al respecto as칤 que lo m치s productivo es explorar el puerto :80
## 2. ENUMERACI칍N

Una vez identificados los servicios, se procede a investigarlos en profundidad en busca de vulnerabilidades o informaci칩n 칰til.

### Puerto 80 ( HTTP)

#### Enumeraci칩n Manual:

- **Navegaci칩n web:** Se visita el sitio en `http://172.17.0.2.
    Tenemos una p치gina con un huevo kinder bastante bacano
    
    ![](Imagenes/150.png)
- **An치lisis del c칩digo fuente:** Se revisa el HTML en busca de comentarios, rutas o scripts ocultos.
    No encontramos nada relevante
	![](Imagenes/151.png)
- **Archivos comunes:** Se buscan manualmente archivos y directorios comunes:
	- `/robots.txt`-->X
	- `/sitemap.xml`--> X
	- `/login`--> X
	- `/admin`--> X
	- `/panel`--> X
	- `/user`--> X
	- `/panel`--> X
	- `backup`--> X
	- `uploads`--> X
	- `test, etc.`--> X
    
    No encontramos nada
#### Enumeraci칩n Autom치tica:

Lanzamos la herramienta `whatweb` para Identificar las tecnolog칤as del servidor en nuestro caso Apache:
```
whatweb 172.17.0.2
```

![](Imagenes/152.png)


Lanzamos la herramienta de enumeraci칩n `gobuster` para buscar directorios ocultos y extensiones .php,.txt y .html 

```
gobuster dir -u http://172.17.0.2/ -w /urs/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,txt,html -k
```

![](CTF/Dockerlabs/0.Muy%20F치cil/Imagenes/166.png)

**Hallazgos:**

- Nos devuelve algunas rutas pero nada llamativo


Tras investigar posibles directivos y  buscar  vulnerabilidades a la versi칩n de Apache sin 칠xito en metasploit. Nos centramos en lo que tenemos, la imagen del huevo bacano. Descargamos la imagen en el directorio de trabajo. 

 Lanzamos la herramienta de estenograf칤a `exiftools`
```
exiftool imagen.jpeg
```
 
  donde podemos ver en su salida el nombre de un usuario: 
  ![](Imagenes/154.png)
  

Como alternativa a `exiftools` podremos usar `strings`
```
strings Unitled.jpeg
```

 ![](Imagenes/155.png)



**Hallazgos:**

- Nos devuelve en su output un user: `borazuwarah`




### 22(SSH)

Si recordamos para acceder al servicio que corre en el puerto :22, el servicio `ssh`, necesitamos alg칰n tipo de credencial. Debemos probar si con este usuario que hemos encontrado `borazuwarah` podemos acceder.

Para ello utilizaremos la fuerza bruta con la herramienta `Hydra` que probar치 un diccionario con miles de opciones de contrase침as para el usuario que le aportamos. 
```
hydra -t 4 -l borazuwarah -P /usr/share/wordlists/rockyou.txt ssh://172.18.0.2
```
Averigua que para el usuario borazuwarah la password es `123456`
borazuwarah:123456

Averigua las credenciales de usuario para el servicio ssh.
![](Imagenes/156.png)
 

**Credenciales obtenidas:**
- **Usuario:** `borazuwarah`
- **Contrase침a:** `123456`


## 3. EXPLOTACI칍N

### 3.1 Acceso inicial :

Con las credenciales descubiertas `borazuwarah:123456`  nos conectamos al servicio ssh:
```
	ssh borazuwarah@172.17.0.2
```

![](Imagenes/157.png)



Como podemos ver, las credenciales ya nos conectan al servicio como el usuario borazuwarah.

## 4. ESCALADA DE PRIVILEGIOS

Una vez dentro, el objetivo es elevar los privilegios del usuario actual al de `root`.

### 4.1. Enumeraci칩n Interna

Se realizan comprobaciones b치sicas y se buscan posibles vectores de escalada.

#### Comprobaciones del sistema:

쯈u칠 usuario somos?
`whoami`

![](Imagenes/158.png)

쮸 qu칠 grupo pertenezco? `id`

![](Imagenes/159.png)
 
쯈u칠 usuario hay en el sistema?
`cd home` y `ls`
![](Imagenes/160.png)
 
 
 쯈u칠 usuario tienen una shell asignada?

`cat /etc/passwd | grep sh`

![](Imagenes/161.png)


Revisamos los directorios de los usuarios:
borazuwarah: 
![](Imagenes/162.png)




Una buena pr치ctica ser칤a revisar los comandos utilizados por los usuarios en el `history`


#### B칰squeda del Vector de Escalada:

- **Permisos Sudo:** 쯈u칠 comandos podemos ejecutar como otro usuario (o `root`)?
	```
    sudo -l
	```
    Con el usuario `borazuwarah`  puede ejecutar una shell `/bin/bash` como usuario `root` sin necesidad de contrase침a.
    ![](Imagenes/153.png)
    
    
	Este ser치 el hilo desde el que tirar para escalar privilegios. 
	La mala configuraci칩n de `sudoers` nos deja un vector de escalada. 
	
	**Cuando lanzamos el comando sudo -l ** podemos ver que tenemos permisos como el usuario borazuwarah para ejecutar como `root` . Pero quer칤a investigar otras alternativas.
	
	![](Imagenes/163.png)
	

- **Binarios SUID/SGID:** 쮼xisten binarios con permisos especiales que puedan ser abusados?
    
	 ```
    find / -perm -4000 2>/dev/null
	 ```
    No encontramos binarios de los que podamos abusar.
    
    ![](Imagenes/164.png)
    


****
### 4.2. Explotaci칩n y Escalada a Root

Se ejecuta la t칠cnica para obtener una shell como `root`.

Para ello ejecutamos `/bin/bash` a trav칠s de `sudo` 
```
sudo /bin/bash
```

![](Imagenes/165.png)


SOMOS ROOT 游


